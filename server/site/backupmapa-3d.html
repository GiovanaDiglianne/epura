<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mapa isolado</title>
<link href="https://unpkg.com/maplibre-gl/dist/maplibre-gl.css" rel="stylesheet"/>
<script src="https://unpkg.com/maplibre-gl/dist/maplibre-gl.js"></script>
<style>
  body,html { margin:0; padding:0; height:100%; }
  #map { width:100%; height:100%; }
</style>
</head>
<body>
<div id="map"></div>
<script>
const apiKey = 'ok7ZFsc8aNh6eVAKsDc3';
const map = new maplibregl.Map({
    container: 'map',
    style: 'https://api.maptiler.com/maps/0198f6a0-6eb4-727b-9907-9038979cc4e9/style.json?key='+apiKey,
    center: [-56.1,-15.6],
    zoom: 12,
    minZoom: 12,
    pitch: 60,
    bearing: -17
});

map.on('load', () => {
  map.addSource('pedra90', { type:'geojson', data:'data/PEDRA90.geojson' });

  map.addLayer({
    id:'pedra90-layer',
    type:'fill',
    source:'pedra90',
    paint:{
      'fill-color': [
        'match',['get','TIPO'],
        'LNE','#000000',
        'SUB','#ff7700',
        'SEL','#00ff23',
        'APP','#a47158',
        'EST','#e8718d',
        'GNP','#6053b7',
        'ELNC','#00660e',
        '#cccccc'
      ],
      'fill-opacity':0.5
    }
  });

  map.addLayer({
    id:'pedra90-outline',
    type:'line',
    source:'pedra90',
    paint:{'line-color':'#000','line-width':0.8}
  });

  // Clique no lote â†’ envia dados para o WordPress
  map.on('click','pedra90-layer', e => {
    const props = e.features[0].properties;
    window.parent.postMessage({acao:"loteSelecionado", dados:props}, "*");
  });
});

// Escuta mensagens vindas do WordPress
window.addEventListener("message", (event) => {
  const msg = event.data;

  if(msg.acao === "filtrar") {
    if(msg.tipos.length === 0) {
      map.setFilter('pedra90-layer',['==',['get','TIPO'],'']); // esconde tudo
    } else {
      map.setFilter('pedra90-layer',['in',['get','TIPO'], ...msg.tipos]);
    }
  }

  if(msg.acao === "zoom") {
    map.flyTo({center: msg.center, zoom: msg.zoom});
  }
});
</script>
</body>
</html>
