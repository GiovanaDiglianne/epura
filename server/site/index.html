<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Mapa estilo OSPA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <style>
    html, body { margin: 0; padding: 0; height: 100%; width: 100%; }
    #map { height: 100%; width: 100%; }
    .sidebar { min-width: 80px; }
    .sidebar .active { background-color: #14532d; } /* botão ativo verde escuro */
  </style>
</head>
<body class="flex">

  <!-- SIDEBAR ESQUERDA -->
  <div class="sidebar bg-green-50 flex flex-col justify-between p-3">

    <!-- Topo -->
    <div class="flex flex-col space-y-4">
      <!-- Home -->
      <div class="flex flex-col items-center">
        <button class="w-12 h-12 flex items-center justify-center rounded-md bg-neutral-70 hover:bg-green-700 active">
          <svg width="24" height="24" fill="currentColor" class="text-white">
            <path d="M17.79 22.75H6.21C3.47 22.75 1.25 20.52 1.25 17.78V10.37C1.25 9.00997 2.09 7.29997 3.17 6.45997L8.56 2.25997C10.18 0.999974 12.77 0.939974 14.45 2.11997L20.63 6.44997C21.82 7.27997 22.75 9.05997 22.75 10.51V17.79C22.75 20.52 20.53 22.75 17.79 22.75Z"/>
            <path d="M12 18.75C11.59 18.75 11.25 18.41 11.25 18V15C11.25 14.59 11.59 14.25 12 14.25C12.41 14.25 12.75 14.59 12.75 15V18C12.75 18.41 12.41 18.75 12 18.75Z"/>
          </svg>
        </button>
      </div>

      <!-- Pesquisa -->
      <div class="flex flex-col items-center">
        <button class="w-12 h-12 flex items-center justify-center rounded-md bg-neutral-70 hover:bg-green-700">
          <svg width="24" height="24" fill="currentColor" class="text-white">
            <path d="M11 20C6.03 20 2 15.97 2 11S6.03 2 11 2s9 4.03 9 9-4.03 9-9 9zm0-16C7.14 4 4 7.14 4 11s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7z"/>
            <path d="M20.3 21.71a1 1 0 0 1-.71-.29l-3.63-3.63a1 1 0 0 1 1.42-1.42l3.63 3.63a1 1 0 0 1-.71 1.71z"/>
          </svg>
        </button>
      </div>

      <!-- Camadas -->
      <div class="flex flex-col items-center">
        <button class="w-12 h-12 flex items-center justify-center rounded-md bg-neutral-70 hover:bg-green-700">
          <svg width="24" height="24" fill="currentColor" class="text-white">
            <path d="M12 2 1 7l11 5 9-4.09V17h2V7L12 2z"/>
            <path d="m1 17 11 5 9-4.09V13l-9 4L1 12z"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- Base da Sidebar -->
    <div class="flex flex-col items-center space-y-4">
      <!-- Configurações -->
      <button class="w-12 h-12 flex items-center justify-center rounded-md bg-neutral-70 hover:bg-green-700">
        <svg width="24" height="24" fill="currentColor" class="text-white">
          <path d="M19.14,12.94c.04-.31.06-.63.06-.94s-.02-.63-.06-.94l2.03-1.58a.5.5 0,0,0,.12-.65l-1.92-3.32a.5.5,0,0,0-.61-.22l-2.39.96a7.007,7.007,0,0,0-1.63-.94L14.5,2h-5l-.34,2.31c-.59.24-1.14.55-1.63.94l-2.39-.96a.5.5,0,0,0-.61.22L2.61,8.83a.5.5,0,0,0,.12.65l2.03,1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03,1.58a.5.5,0,0,0-.12.65l1.92,3.32c.14.24.44.34.71.22l2.39-.96c.49.39,1.04.7,1.63.94l.34,2.31h5l.34-2.31c.59-.24,1.14-.55,1.63-.94l2.39.96c.27.12.57.02.71-.22l1.92-3.32a.5.5,0,0,0-.12-.65l-2.03-1.58Z"/>
        </svg>
      </button>

      <!-- Perfil -->
      <button class="w-12 h-12 flex items-center justify-center rounded-md bg-neutral-70 hover:bg-green-700">
        <svg width="24" height="24" fill="currentColor" class="text-white">
          <path d="M12 12c2.67 0 8 1.34 8 4v4H4v-4c0-2.66 5.33-4 8-4zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8z"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- MAPA -->
  <div id="map" class="flex-1"></div>

  <script>
      const map = L.map('map').setView([-15.6, -56.1], 12);

      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '© OpenStreetMap contributors'
      }).addTo(map);

      const wmsUrl = 'http://localhost:8000/qgis-server/';
      const wmsLayer = L.tileLayer.wms(wmsUrl, {
          layers: 'COXIPO',
          format: 'image/png',
          transparent: true,
          version: '1.3.0',
          crs: L.CRS.EPSG4326,
          attribution: "Meu Projeto QGIS Server"
      }).addTo(map);

      // Carregamento e exibição do GeoJSON
      fetch('http://localhost:8000/data/COXIPO_WGS84.geojson')
        .then(res => {
            if (!res.ok) {
                throw new Error('Erro ao carregar GeoJSON: ' + res.status);
            }
            return res.json();
        })
        .then(data => {
            const geoJsonLayer = L.geoJSON(data, {
                style: function (feature) {
                    return {
                        color: "#ff7800",
                        weight: 5,
                        opacity: 0.65,
                        fillColor: "#ff7800",
                        fillOpacity: 0.2
                    };
                }
            }).addTo(map);

            // Obtém os limites (bounds) da camada GeoJSON
            const geoJsonBounds = geoJsonLayer.getBounds();

            // Verifica se os limites são válidos antes de ajustar o mapa
            if (geoJsonBounds.isValid()) {
                // 1. Limita a navegação do mapa aos limites do GeoJSON
                map.setMaxBounds(geoJsonBounds);

                // 2. Ajusta a visualização para os limites do GeoJSON na carga inicial
                map.fitBounds(geoJsonBounds);

                console.log('GeoJSON carregado, mapa limitado e ajustado.');
            } else {
                console.error('As geometrias do GeoJSON são inválidas ou estão fora da visualização.');
            }
        })
        .catch(err => console.error('Erro geral ao carregar GeoJSON:', err));
  </script>
</body>
</html>
